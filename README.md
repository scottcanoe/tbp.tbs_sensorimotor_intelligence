# tbp.tbs_sensorimotor_intelligence

This repository contains code to replicate experiments from our paper, "Thousand Brains Systems: Sensorimotor Intelligence for Rapid, Robust Learning and Inference".

Experiments make use of either the Monty framework, or Pytorch in the case of deep learning models. Instructions for environment setup and experiment execution can be found in the README files within `monty/` ([here](monty/README.md)) and `pytorch/` ([here](pytorch/README.md)). Information on licensing can also be found in the respective directories.

The basic structure of this repository is as follows:

 - `monty/`: Contains all the code needed to run experiments using [tbp.monty](https://github.com/thousandbrainsproject/tbp.monty), the open-source, sensorimotor learning system presented in our paper. This directory also includes instructions for setting up a Python environment and executing the experiments. See [here](monty/README.md) for details.
 - `pytorch/`: Contains the vision transformer (ViT) model used in the paper and the experiments performed with it. Like `monty/`, this directory contains instructions for setting up an appropriate Python environment. See [here](pytorch/README.md) for details.
 - `scripts/`: Contains analysis and plotting scripts used to generate figures for the paper. TODO: specify which environment (or either?) will work for these. See [here](scripts/README.md) for details.
  

## Filesystem Setup

Experiments and plotting scripts in this repository access three main directories -- `DMC_ROOT_DIR`, `DMC_ANALYSIS_DIR`, and `MONTY_DATA` -- each of which can be modified by setting the corresponding environment variable. (Note that DMC is shorthand for Demonstrating Monty's Capabilities, the name of this project we have been using internally.)

- `DMC_ROOT_DIR` holds the output generated by experiments, including pretraining experiments. It defaults to `~/tbp/results/dmc/`, and it has the following subdirectories:
   - `pretrained_models/`: Models generated by running Monty's pretraining experiments. Required to run evaluation experiments using `tbp.monty`.
   - `results/`: Output generated by running the core (evaluation) experiments with Monty. Required to run plotting scripts.
   - `visualizations/`: Output from a second set of Monty experiments designed to capture detailed data used in some figure visualizations. Required to run plotting scripts.
   - `view_finder_images/`: Intermediate data generated by Monty that was used to train and evaluate the ViT model. Not required for running experiments with `tbp.monty` or running plotting scripts.

  Any of the above may either be [downloaded](#downloading-datasets) or recomputed locally.
- `DMC_ANALYSIS_DIR` holds the output generated by plotting scripts, and it defaults to `~/tbp/results/dmc_analysis`. Its subdirectories are matched to plotting scripts (e.g., `scripts/fig4.py` stores its output to `DMC_ANALYSIS_DIR/fig4/`).

- `MONTY_DATA` is used only by `tbp.monty`, and it contains the [YCB object dataset](https://www.ycbbenchmarks.com/). It defaults to `~/tbp/data`.


## Downloading Datasets

Any or all of the datasets used in this paper can be downloaded using `download.py`, and the datasets you'll need will depend on your specific use case. For example, if you intend to reproduce all Monty-related results from scratch, including pretraining the models, you'd only need the [YCB object dataset](https://www.ycbbenchmarks.com/). Using `download.py`, you'd run
```shell
$ python download.py ycb
```

On the other hand, if you only want to regenerate figures using precomputed data, you would run
```shell
$ python download.py monty.pretrained_models monty.results monty.visualizations
```

For running experiments using Monty and/or plotting their results, the following table should help you decide which datasets you'll need based on your intended use.


|                          | ycb | monty.pretrained_models | monty.results | monty.visualizations |
|--------------------------|:---:|:------------------------:|:-------------:|:---------------------:|
| Run Pretraining Experiments | ✓   |                          |               |                       |
| Run Evaluation Experiments | ✓   | ✓                        |               |                       |
| Run Plotting Scripts (2-6)       |     | ✓                        | ✓             | ✓                     |

Note: `monty.view_finder_images` is omitted since it is not required for any of these use cases, but it is still available.

<br>


**TODO** ViT Datasets.

The following table lists (compressed) file sizes for each datasets and where
they are downloaded to when using `download.py`.

|          Dataset          |   Size   |  Downloads To  |
|--------------------------|---------:|:--------------|
| ycb                       | ~500 MB  | MONTY_DATA |
| monty.pretrained_models   |  3.4 GB  | DMC_ROOT_DIR |
| monty.results             |  3.2 MB  | DMC_ROOT_DIR |
| monty.visualizations      | ~850 MB  | DMC_ROOT_DIR |
| monty.view_finder_images  | ~400 MB  | DMC_ROOT_DIR |


## Running the Experiments

Instructions for running experiments using Monty can be found [here](monty/README.md). For running experiments using the ViT model, see [here](pytorch/README.md).

## Reproducting Figures from the Paper

Analaysis scripts to generate the figures are located in the `scripts` directory. The data for figures can either be generated via `configs`, or you can directly download the pre-trained models at `link-to-be-confirmed` and the raw results from experiments at `link-to-be-confirmed`.
